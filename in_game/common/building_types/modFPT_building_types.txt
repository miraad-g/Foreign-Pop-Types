# Any foreign building is the same as vanilla, but with pop_type = foreign_**

###########################################################
# \in_game\common\building_types\event_only_buildings.txt #
###########################################################
TRY_REPLACE:bodrum_castle = {
    pop_type = foreign_clergy
    max_levels = 1

    employment_size = huge_religious_building_employment

    rural_settlement = yes
    town = yes
    city = yes

    need_good_relation = yes

    category = defense_category

    expensive = yes
    build_time = generic_event_building

    country_potential = {
        always = no
    }
    allow = {
        always = no
    }

    is_foreign = yes

    modifier = {
        manpower_to_building_owner = 0.005
        gold_to_building_owner = 3
    }

    possible_production_methods = {
        basic_castle_maintenance
    }

    on_built = {
        location = {
            add_core = owner
        }
    }
    on_destroyed = {
        location = {
            remove_core = owner
        }
    }

    construction_demand = soldier_building_construction
}

TRY_REPLACE:chi_macau_port = {
    is_foreign = yes
    stronger_power_projection = no
    max_levels = guild_max_level
    need_good_relation = yes
    pop_type = foreign_burghers

    rural_settlement = yes
    town = yes
    city = yes

    country_potential = {
        always = no
    }
    allow = {
        always = no
    }

    category = trade_category

    employment_size = foreign_trade_employment



    build_time = trade_post_build_time

    possible_production_methods = {
        port_building_maintenance
    }

    modifier = {
        merchant_capacity_from_building = 0.2
        building_owner_maritime_presence = 0.025
        local_merchant_capacity = 1
        # gold_to_location_owner = 20 CAESAR-25168
    }
}

TRY_REPLACE:chi_missionary_building = {
    is_foreign = yes
    max_levels = 1
    pop_type = foreign_clergy

    category = colonial_category
    graphical_tags = { small_religious }

    need_good_relation = yes

    employment_size = religious_building_employment

    pop_size_created = religious_building_employment

    rural_settlement = yes
    town = yes
    city = yes

    country_potential = {
        always = no
    }

    allow = {
        always = no #Starting building
    }




    possible_production_methods = {
        colony_maintenance
    }
    construction_demand = colony_construction


    build_time = colonise_build_time

    modifier = {
        building_missionary_effort = 0.01
        local_burghers_max_literacy = 10
    }

}

TRY_REPLACE:dutch_trade_outpost = {
    is_foreign = yes
    pop_type = foreign_burghers
    employment_size = foreign_trade_employment
    max_levels = 1
    category = trade_category
    town = yes
    city = yes

    need_good_relation = yes

    country_potential = {
        always = no
    }
    allow = {
        always = no
    }
    expensive = yes
    build_time = trade_post_build_time
    modifier = {
        merchant_capacity_from_building = 1.0
        building_owner_maritime_presence = 0.025
    }

    unique_production_methods = {
        dutch_trade_outpost_maintenance = {
            lumber = 0.25
            tools = 0.05

            category = building_maintenance
        }
    }
    construction_demand = market_center_building_construction
}

TRY_REPLACE:swi_collegium_helveticum = {
    is_foreign = yes
    pop_type = foreign_clergy
    max_levels = 1

    category = cultural_category

    need_good_relation = yes

    employment_size = large_religious_building_employment

    rural_settlement = no
    town = yes
    city = yes

    country_potential = {
        OR = {
            has_or_had_tag = SWI
            has_or_had_tag = BCH
            has_or_had_tag = STG
            has_or_had_tag = ZUR
            has_or_had_tag = SYZ
            has_or_had_tag = GLR
            has_or_had_tag = URI
            has_or_had_tag = OBW
            has_or_had_tag = LCU
            has_or_had_tag = SIT
            has_or_had_tag = BRN
            has_or_had_tag = SLT
            has_or_had_tag = NEU
            has_or_had_tag = BAS
            has_or_had_tag = LSA
            has_or_had_tag = KYB
            has_or_had_tag = TRN
            has_or_had_tag = GNV
            has_or_had_tag = SCL
            has_or_had_tag = WER
        }
    }

    allow = {
        custom_tooltip = {
            text = swi_collegium_helveticum_why
            always = no
        }
    }

    expensive = yes

    build_time = cultural_building_time

    modifier = {
        gold_to_building_owner = 2
    }
    unique_production_methods = {
        swi_collegium_helveticum_maintenance = {
            paper = 0.5
            books = 0.25
            glass = 0.25
            category = building_maintenance
        }
    }
    construction_demand = swi_collegium_helveticum_construction
}

TRY_REPLACE:ori_portuguese_quarters = {
    is_foreign = yes
    pop_type = foreign_burghers
    employment_size = foreign_trade_employment
    max_levels = 1
    category = trade_category
    town = yes
    city = yes

    need_good_relation = yes

    country_potential = {
        always = no
    }
    allow = {
        always = no
    }

    expensive = yes
    build_time = trade_post_build_time
    modifier = {
        building_owner_maritime_presence = 0.025
        local_max_rgo_size = 3
        local_rgo_build_time = -0.25
        local_build_buildings_cost = -0.15
    }
    possible_production_methods = {
        ori_portuguese_quarters_maintenance
    }
    construction_demand = market_center_building_construction
}

########################################################
# \in_game\common\building_types\foreign_buildings.txt #
########################################################

TRY_REPLACE:trade_office = {
    is_foreign = yes
    stronger_power_projection = no
    max_levels = guild_max_level
    need_good_relation = yes
    pop_type = foreign_burghers

    category = trade_category

    employment_size = foreign_trade_employment

    rural_settlement = no
    town = yes
    city = yes

    allow = {
        is_port = yes
        market = { in_trade_range_of = scope:actor }
    }



    build_time = trade_post_build_time

    unique_production_methods = {
        trade_office_requirements = {
            paper = 0.1
            category = building_maintenance
        }
    }


    modifier = {
        merchant_capacity_from_building = 0.3
        building_owner_maritime_presence = 0.05
        merchant_power_from_building = 0.2
    }
}

TRY_REPLACE:embassy = {
    is_foreign = yes
    stronger_power_projection = no
    max_levels = 1
    need_good_relation = yes
    pop_type = foreign_nobles

    category = government_category

    employment_size = minor_noble_employment

    rural_settlement = no
    town = yes
    city = yes

    allow = {
        is_capital = yes
        scope:actor.country_rank_level <= owner.country_rank_level
    }
    remove_if = {
        is_no_longer_capital = yes
    }



    build_time = trade_post_build_time

    lifts_fog_of_war = yes

    unique_production_methods = {
        embassy_requirements = {
            paper = 1.0
            jewelry = 0.5

            category = building_maintenance
        }
    }

    foreign_country_modifier = {
        diplomatic_capacity = 0.1
    }
}

TRY_REPLACE:missionary_building = {
    in_empty = empty
    is_foreign = yes
    max_levels = 1
    pop_type = foreign_clergy
    graphical_tags = { small_religious }

    category = colonial_category

    employment_size = religious_building_employment

    pop_size_created = religious_building_employment

    rural_settlement = yes
    town = no
    city = no

    allow = {
        OR = {
            is_coastal_within_range = yes
            is_adjacent_to_owned_or_subject_owns = yes
        }
        NOT = { dominant_religion = scope:actor.religion }
    }




    possible_production_methods = {
        colony_maintenance
    }
    construction_demand = simple_colony_construction


    build_time = colonise_build_time

    modifier = {
        building_missionary_effort = 0.1
        local_tribal_promotion = 0.5
        local_disease_resistance = 0.05
    }
}

TRY_REPLACE:slave_center = {
    in_empty = any
    is_foreign = yes
    stronger_power_projection = yes
    max_levels = 1
    pop_type = foreign_burghers

    category = colonial_category


    employment_size = foreign_trade_employment

    pop_size_created = foreign_trade_employment

    rural_settlement = yes
    town = yes
    city = yes

    location_potential = {
        NOT = { dominant_religion.group = scope:actor.religion.group }
        owner ?= { religion != scope:actor.religion }
    }

    allow = {
        OR = {
            sub_continent = sub_continent:west_africa
            sub_continent = sub_continent:central_africa
        }
        OR = {
            is_coastal_within_range = yes
            is_adjacent_to_owned_or_subject_owns = yes
        }
        scope:actor = { has_slavery = yes }
    }




    build_time = colonise_build_time

    unique_production_methods = {
        slave_center_maintenance = {
            stone = 0.3
            tools = 0.3
            firearms = 0.33
            paper = 0.1
            produced = slaves_goods
            output = 1
            category = building_maintenance
        }
    }
    construction_demand = simple_colony_construction


    modifier = {
        building_enslavement_power = 0.050
    }
}

TRY_REPLACE:overseas_trading_post = {
    in_empty = any
    is_foreign = yes
    max_levels = 1
    pop_type = foreign_burghers

    stronger_power_projection = yes

    category = colonial_category

    employment_size = foreign_trade_employment

    pop_size_created = foreign_trade_employment

    rural_settlement = yes
    town = no
    city = no


    location_potential = {
        NOT = { continent = scope:actor.capital.continent }
    }
    allow = {
        OR = {
            is_coastal_within_range = yes
            is_adjacent_to_owned_or_subject_owns = yes
        }
    }



    possible_production_methods = {
        fur_trading_post_maintenance
    }
    construction_demand = simple_colony_construction


    build_time = colonise_build_time

    modifier = {
        merchant_capacity_from_building = 0.1
        merchant_power_from_building = 0.2
    }
}

#######################################################
# \in_game\common\building_types\pirate_buildings.txt #
#######################################################

TRY_REPLACE:black_market = {
    is_foreign = yes
    stronger_power_projection = no
    max_levels = 10
    pop_type = foreign_peasants

    category = trade_category

    need_good_relation = yes

    employment_size = pirate_building_employment

    rural_settlement = no
    town = yes
    city = yes
    country_potential = {
        has_reform = government_reform:pirate_brethren_reform
        modifier:enable_black_market_buildings = yes
    }
    location_potential = { is_coastal = yes }

    possible_production_methods = {
        black_market_maintenance
    }
    build_time = pirate_build_time

    modifier = {
        scaled_gold_to_building_owner = 0.05
        merchant_capacity_from_building = 2
    }
}

##############################################################
# \in_game\common\building_types\trade_company_buildings.txt #
##############################################################

TRY_REPLACE:trade_company_headquarters = {
    is_foreign = yes
    max_levels = trade_company_headquarters_max_level
    pop_type = foreign_burghers
    own_or_overlord_relation_needed = trade_access
    category = trade_category
    employment_size = huge_foreign_trade_employment
    rural_settlement = yes
    town = yes
    city = yes
    expensive = yes
    country_potential = {
        total_effective_building_levels:trade_company_headquarters < 1

        custom_tooltip = {
            text = building_trade_hq_only_one
            NOT = { has_variable = building_trade_hq }
        }

        num_relations_above_limit <= 0

    }


    allow = {
        market = { in_trade_range_of = scope:actor }
        scope:actor = {
            OR = {
                NOT = { has_variable_list = trade_company_regions }
                NOT = {
                    is_target_in_variable_list = {
                        name = trade_company_regions
                        target = root.region
                    }
                }
            }
        }
    }
    build_time = trade_company_headquarters_time
    unique_production_methods = {
        trade_company_headquarters_requirements = {
            paper = 0.1
            category = building_maintenance
        }
    }
    modifier = {
        merchant_capacity_from_building = 0.2
        building_owner_maritime_presence = 0.02
        scaled_gold_to_building_owner = 0.2
        building_owner_overlord_maritime_presence = 0.05
        scaled_gold_to_building_owner_overlord = 0.5
        local_crown_estate_power = -0.2
    }
    capital_country_modifier = {
        number_of_satellite_trade_buildings = 3
    }
    raw_modifier = {
        local_monthly_development = 0.01
        local_monthly_prosperity = 0.001
        local_build_buildings_cost = -0.1
    }
    custom_tags = { trade_company_building }

    on_construction_started = {
        owner = {
            set_variable = {
                name = building_trade_hq
                value = 1
            }
        }
    }

    on_construction_ended = {
        owner = {
            remove_variable = building_trade_hq
        }
    }


    on_built = {
        owner = { save_scope_as = overlord }
        location = {
            save_scope_as = capital
            create_building_country_in_location = {
                reforms = {
                    banking_country
                }
                save_scope_as = trade_company_tag

                hidden_effect = {
                    change_heir_selection = heir_selection:bank_selection
                    change_government_type = government_type:republic
                    make_subject_of = {
                        target = scope:overlord
                        type = subject_type:trade_company
                    }
                }
            }
            if = {
                limit = { exists = scope:trade_company_tag }
                root = { change_building_owner = scope:trade_company_tag }
                scope:trade_company_tag = {
                    set_capital = scope:capital
                    set_variable = { name = trade_company_home_region value = scope:capital.region }
                    if = {
                        limit = {
                            OR = {
                                NOT = { has_variable_list = trade_company_regions }
                                NOT = {
                                    is_target_in_variable_list = {
                                        name = trade_company_regions
                                        target = root.region
                                    }
                                }
                            }
                        }
                        add_to_variable_list = {
                            name = trade_company_regions
                            target = scope:capital.region
                        }
                    }
                }
            }
        }
        scope:overlord = {
            if = {
                limit = {
                    exists = scope:capital
                    exists = scope:trade_company_tag
                    OR = {
                        NOT = { has_variable_list = trade_company_regions }
                        is_target_in_variable_list = {
                            name = trade_company_regions
                            target = scope:capital.region
                        }
                    }
                }
                add_to_variable_list = {
                    name = trade_company_regions
                    target = scope:capital.region
                }
                add_to_variable_list = {
                    name = trade_company_subjects
                    target = scope:trade_company_tag
                }
            }
        }
    }
}

TRY_REPLACE:trade_company_garrison = {
    is_foreign = yes
    max_levels = trade_company_building_max_level
    pop_type = foreign_burghers
    own_or_overlord_relation_needed = trade_access
    category = trade_category
    employment_size = large_foreign_trade_employment
    rural_settlement = yes
    town = yes
    city = yes
    build_time = trade_company_build_time
    possible_production_methods = {
        satellite_trade_building_requirements
    }
    location_potential = {
        scope:actor = {
            has_variable_list = trade_company_regions
            is_target_in_variable_list = {
                name = trade_company_regions
                target = root.region
            }
        }
    }
    country_potential = {
        OR = {
            total_effective_building_levels:trade_company_headquarters > 0
            any_subject = {
                total_effective_building_levels:trade_company_headquarters > 0
            }
        }
    }
    allow = {
        market = { in_trade_range_of = scope:actor }
        scope:actor = {
            total_effective_building_levels:trade_company_garrison < {
                if = {
                    limit = {
                        scope:actor = {
                            is_subject = yes
                            overlord.modifier:number_of_satellite_trade_buildings > modifier:number_of_satellite_trade_buildings
                        }
                    }
                    value = scope:actor.overlord.modifier:number_of_satellite_trade_buildings
                }
                else = {
                    value = scope:actor.modifier:number_of_satellite_trade_buildings
                }
            }
        }
    }
    custom_tags = { trade_company_building satellite_trade_building }
    modifier = {
        local_defensive = 0.25
        local_garrison_size = 0.5
    }
    on_built = {
        owner = {
            if = {
                limit = { NOT = { has_variable = trade_company_home_region } }
                save_temporary_scope_as = owner_scope
                random_in_list = {
                    variable = trade_company_subjects
                    limit = {
                        has_variable = trade_company_home_region
                        var:trade_company_home_region = {
                            save_temporary_scope_as = target_region
                        }
                        scope:owner_scope = {
                            is_target_in_variable_list = {
                                name = trade_company_regions
                                target = scope:target_region
                            }
                        }
                    }
                    save_scope_as = trade_company_country
                }
                if = {
                    limit = { exists = scope:trade_company_country }
                    root = { change_building_owner = scope:trade_company_country }
                }
                else = {
                    root.location = { destroy_building = root }
                }
            }
        }
    }
}

TRY_REPLACE:trade_company_harbor = {
    is_foreign = yes
    max_levels = trade_company_building_max_level
    pop_type = foreign_burghers
    own_or_overlord_relation_needed = trade_access
    category = trade_category
    employment_size = large_foreign_trade_employment
    rural_settlement = yes
    town = yes
    city = yes
    build_time = trade_company_build_time
    possible_production_methods = {
        satellite_trade_building_requirements
    }
    location_potential = {
        scope:actor = {
            has_variable_list = trade_company_regions
            is_target_in_variable_list = {
                name = trade_company_regions
                target = root.region
            }
        }
    }
    country_potential = {
        OR = {
            total_effective_building_levels:trade_company_headquarters > 0
            any_subject = {
                total_effective_building_levels:trade_company_headquarters > 0
            }
        }
    }
    allow = {
        is_port = yes
        market = { in_trade_range_of = scope:actor }
        scope:actor = {
            total_effective_building_levels:trade_company_harbor < {
                if = {
                    limit = {
                        scope:actor = {
                            is_subject = yes
                            overlord.modifier:number_of_satellite_trade_buildings > modifier:number_of_satellite_trade_buildings
                        }
                    }
                    value = scope:actor.overlord.modifier:number_of_satellite_trade_buildings
                }
                else = {
                    value = scope:actor.modifier:number_of_satellite_trade_buildings
                }
            }
        }
    }
    custom_tags = { trade_company_building satellite_trade_building }
    modifier = {
        merchant_power_from_building = 0.5
        building_owner_maritime_presence = 0.01
        building_owner_overlord_maritime_presence = 0.02
    }
    on_built = {
        owner = {
            if = {
                limit = { NOT = { has_variable = trade_company_home_region } }
                save_temporary_scope_as = owner_scope
                random_in_list = {
                    variable = trade_company_subjects
                    limit = {
                        has_variable = trade_company_home_region
                        var:trade_company_home_region = {
                            save_temporary_scope_as = target_region
                        }
                        scope:owner_scope = {
                            is_target_in_variable_list = {
                                name = trade_company_regions
                                target = scope:target_region
                            }
                        }
                    }
                    save_scope_as = trade_company_country
                }
                if = {
                    limit = { exists = scope:trade_company_country }
                    root = { change_building_owner = scope:trade_company_country }
                }
                else = {
                    root.location = { destroy_building = root }
                }
            }
        }
    }
}

TRY_REPLACE:trade_company_local_venture = {
    is_foreign = yes
    max_levels = trade_company_building_max_level
    pop_type = foreign_burghers
    own_or_overlord_relation_needed = trade_access
    category = trade_category
    employment_size = large_foreign_trade_employment
    rural_settlement = yes
    town = yes
    city = yes
    build_time = trade_company_build_time
    possible_production_methods = {
        satellite_trade_building_requirements
    }
    location_potential = {
        scope:actor = {
            has_variable_list = trade_company_regions
            is_target_in_variable_list = {
                name = trade_company_regions
                target = root.region
            }
        }
    }
    country_potential = {
        OR = {
            total_effective_building_levels:trade_company_headquarters > 0
            any_subject = {
                total_effective_building_levels:trade_company_headquarters > 0
            }
        }
    }
    allow = {
        market = { in_trade_range_of = scope:actor }
        scope:actor = {
            total_effective_building_levels:trade_company_local_venture < {
                if = {
                    limit = {
                        scope:actor = {
                            is_subject = yes
                            overlord.modifier:number_of_satellite_trade_buildings > modifier:number_of_satellite_trade_buildings
                        }
                    }
                    value = scope:actor.overlord.modifier:number_of_satellite_trade_buildings
                }
                else = {
                    value = scope:actor.modifier:number_of_satellite_trade_buildings
                }
            }
        }
    }
    custom_tags = { trade_company_building satellite_trade_building }
    modifier = {
        local_raw_material_output = 0.33
    }
    on_built = {
        owner = {
            if = {
                limit = { NOT = { has_variable = trade_company_home_region } }
                save_temporary_scope_as = owner_scope
                random_in_list = {
                    variable = trade_company_subjects
                    limit = {
                        has_variable = trade_company_home_region
                        var:trade_company_home_region = {
                            save_temporary_scope_as = target_region
                        }
                        scope:owner_scope = {
                            is_target_in_variable_list = {
                                name = trade_company_regions
                                target = scope:target_region
                            }
                        }
                    }
                    save_scope_as = trade_company_country
                }
                if = {
                    limit = { exists = scope:trade_company_country }
                    root = { change_building_owner = scope:trade_company_country }
                }
                else = {
                    root.location = { destroy_building = root }
                }
            }
        }
    }
}

TRY_REPLACE:trade_company_foreign_influence = {
    is_foreign = yes
    max_levels = trade_company_building_max_level
    pop_type = foreign_burghers
    own_or_overlord_relation_needed = trade_access
    category = trade_category
    employment_size = large_foreign_trade_employment
    rural_settlement = yes
    town = yes
    city = yes
    build_time = trade_company_build_time
    possible_production_methods = {
        satellite_trade_building_requirements
    }
    location_potential = {
        scope:actor = {
            has_variable_list = trade_company_regions
            is_target_in_variable_list = {
                name = trade_company_regions
                target = root.region
            }
        }
    }
    country_potential = {
        OR = {
            total_effective_building_levels:trade_company_headquarters > 0
            any_subject = {
                total_effective_building_levels:trade_company_headquarters > 0
            }
        }
    }
    allow = {
        market = { in_trade_range_of = scope:actor }
        scope:actor = {
            total_effective_building_levels:trade_company_foreign_influence < {
                if = {
                    limit = {
                        scope:actor = {
                            is_subject = yes
                            overlord.modifier:number_of_satellite_trade_buildings > modifier:number_of_satellite_trade_buildings
                        }
                    }
                    value = scope:actor.overlord.modifier:number_of_satellite_trade_buildings
                }
                else = {
                    value = scope:actor.modifier:number_of_satellite_trade_buildings
                }
            }
        }
    }
    custom_tags = { trade_company_building satellite_trade_building }
    modifier = {
        local_monthly_development = 0.005
        local_max_control = 0.05
    }
    on_built = {
        owner = {
            if = {
                limit = { NOT = { has_variable = trade_company_home_region } }
                save_temporary_scope_as = owner_scope
                random_in_list = {
                    variable = trade_company_subjects
                    limit = {
                        has_variable = trade_company_home_region
                        var:trade_company_home_region = {
                            save_temporary_scope_as = target_region
                        }
                        scope:owner_scope = {
                            is_target_in_variable_list = {
                                name = trade_company_regions
                                target = scope:target_region
                            }
                        }
                    }
                    save_scope_as = trade_company_country
                }
                if = {
                    limit = { exists = scope:trade_company_country }
                    root = { change_building_owner = scope:trade_company_country }
                }
                else = {
                    root.location = { destroy_building = root }
                }
            }
        }
    }
}

TRY_REPLACE:trade_company_governance = {
    is_foreign = yes
    max_levels = trade_company_building_max_level
    pop_type = foreign_burghers
    own_or_overlord_relation_needed = trade_access
    category = trade_category
    employment_size = large_foreign_trade_employment
    rural_settlement = yes
    town = yes
    city = yes
    build_time = trade_company_build_time
    possible_production_methods = {
        satellite_trade_building_requirements
    }
    location_potential = {
        scope:actor = {
            has_variable_list = trade_company_regions
            is_target_in_variable_list = {
                name = trade_company_regions
                target = root.region
            }
        }
    }
    country_potential = {
        OR = {
            total_effective_building_levels:trade_company_headquarters > 0
            any_subject = {
                total_effective_building_levels:trade_company_headquarters > 0
            }
        }
    }
    allow = {
        market = { in_trade_range_of = scope:actor }
        scope:actor = {
            total_effective_building_levels:trade_company_governance < {
                if = {
                    limit = {
                        scope:actor = {
                            is_subject = yes
                            overlord.modifier:number_of_satellite_trade_buildings > modifier:number_of_satellite_trade_buildings
                        }
                    }
                    value = scope:actor.overlord.modifier:number_of_satellite_trade_buildings
                }
                else = {
                    value = scope:actor.modifier:number_of_satellite_trade_buildings
                }
            }
        }
    }
    custom_tags = { trade_company_building satellite_trade_building }
    modifier = {
        manpower_to_building_owner = 0.003
        sailors_to_building_owner = 0.005
        can_recruit_regiment_in_this_location = yes
    }
    on_built = {
        owner = {
            if = {
                limit = { NOT = { has_variable = trade_company_home_region } }
                save_temporary_scope_as = owner_scope
                random_in_list = {
                    variable = trade_company_subjects
                    limit = {
                        has_variable = trade_company_home_region
                        var:trade_company_home_region = {
                            save_temporary_scope_as = target_region
                        }
                        scope:owner_scope = {
                            is_target_in_variable_list = {
                                name = trade_company_regions
                                target = scope:target_region
                            }
                        }
                    }
                    save_scope_as = trade_company_country
                }
                if = {
                    limit = { exists = scope:trade_company_country }
                    root = { change_building_owner = scope:trade_company_country }
                }
                else = {
                    root.location = { destroy_building = root }
                }
            }
        }
    }
}

#######################################################
# \in_game\common\building_types\unique_buildings.txt #
#######################################################

TRY_REPLACE:hanseatic_kontor = {
    is_foreign = yes
    need_good_relation = yes
    pop_type = foreign_burghers

    category = trade_category

    max_levels = hanseatic_kontor_max_level
    employment_size = large_foreign_trade_employment

    rural_settlement = no
    town = yes
    city = yes

    increase_per_level_cost = 0.5

    country_potential = {
        modifier:allows_hanseatic_federation_buildings = yes
    }


    build_time = trade_post_build_time

    modifier = {
        merchant_power_from_building = 1.0
        building_owner_maritime_presence = 0.1
        merchant_capacity_from_building = 0.25
    }

    possible_production_methods = {
        kontor_maintenance
    }
    construction_demand = kontor_construction
}

TRY_REPLACE:hanseatic_shipwright_guild = {
    is_foreign = yes
    need_good_relation = yes

    pop_type = foreign_laborers
    max_levels = hanseatic_shipwright_guild_max_level
    category = military_category
    country_potential = {
        modifier:allows_hanseatic_federation_buildings = yes
    }
    location_potential = {
        owner = { is_subject_of = c:HSA }
        is_port = yes
    }
    employment_size = dock_employment
    pop_size_created = dock_employment
    town = yes
    city = yes
    build_time = medium_port_building_time
    expensive = yes
    possible_production_methods = {
        port_building_maintenance
    }
    construction_demand = port_building_construction
    modifier = {
        max_ships_built_at_same_time = 1
        sailors_to_building_owner = 0.01
        can_build_ships_in_this_location = yes
        harbor_suitability = 0.1
    }
}

TRY_REPLACE:hanseatic_town_hall = {
    is_foreign = yes
    need_good_relation = yes

    pop_type = foreign_nobles

    category = trade_category

    max_levels = 2
    employment_size = normal_noble_employment

    rural_settlement = no
    town = yes
    city = yes

    increase_per_level_cost = 0.5


    expensive = yes

    location_potential = {
        this = c:HSA.capital
    }

    country_potential = {
        modifier:allows_hanseatic_federation_buildings = yes
    }

    build_time = large_capital_build_time

    capital_country_modifier = {
        country_cabinet_efficiency = 0.1
        monthly_republican_tradition = 0.05
        parliament_base_support = 0.05
    }
    remove_if = {
        owner = {
            NOT = { country_type = building }
        }
    }

    possible_production_methods = {
        hanseatic_town_hall_maintenance
    }
    construction_demand = hanseatic_town_hall_construction
}

TRY_REPLACE:fondaco = {
    is_foreign = yes
    need_good_relation = yes
    pop_type = foreign_burghers

    category = trade_category

    max_levels = guild_max_level
    employment_size = foreign_trade_employment
    pop_size_created = foreign_trade_employment

    rural_settlement = no
    town = yes
    city = yes

    increase_per_level_cost = 0.5


    country_potential = {
        is_merchant_republic = yes
        culture = { has_culture_group = culture_group:italian_group }
    }
    allow = {
        within_naval_range_of = scope:actor
        owner = {
            giving_scripted_relation = {
                type = relation_type:fondaco_rights
                target = scope:actor
            }
        }
    }


    build_time = trade_post_build_time

    modifier = {
        merchant_power_from_building = 1.0
        building_owner_maritime_presence = 0.025
        merchant_capacity_from_building = 0.2
        #Italian merchants settle in the new location
        local_migration_attraction = 0.025
    }

    possible_production_methods = {
        fondaco_maintenance
    }
    construction_demand = fondaco_construction
}

TRY_REPLACE:order_commandery = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_clergy

    category = religious_category

    max_levels = 1
    employment_size = order_religious_building_employment

    rural_settlement = yes
    town = yes
    city = yes

    allow_wrong_startup = yes


    location_potential = {
        custom_tooltip = {
            text = order_commandery_tt
            owner = {
                giving_scripted_relation = {
                    type = relation_type:military_sponsorship
                    target = scope:actor
                }
            }
        }
    }


    country_potential = {
        modifier:target_of_military_sponsorships = yes
        religion = religion:catholic
    }

    build_time = soldier_building

    allow = {
        owner = { within_diplomatic_range = scope:actor }
        dominant_religion = religion:catholic
    }

    remove_if = {
        OR = {
            location = {
                dominant_religion != religion:catholic
            }
            owner = {
                OR = {
                    modifier:target_of_military_sponsorships = no
                    religion != religion:catholic
                }
            }
        }
    }


    on_built = {
        if = {
            limit = {
                location.owner != root.owner
            }
            location.owner = {
                add_opinion = { target = root.owner modifier = opinion_reformation_diplomacy }
            }
        }
    }

    modifier = {
        gold_to_building_owner = 0.1
        manpower_to_building_owner = 0.005
    }
    construction_demand = order_commandery_construction
    possible_production_methods = {
        order_commandery_maintenance
    }
    graphical_tags = { small_military }
}

TRY_REPLACE:banking_office = {
    is_foreign = yes
    need_good_relation = yes
    pop_type = foreign_burghers

    category = trade_category

    max_levels = 1
    employment_size = foreign_trade_employment

    rural_settlement = no
    town = yes
    city = yes




    country_potential = {
        has_reform = government_reform:banking_country
    }

    build_time = bank_office_build_time

    modifier = {
        merchant_power_from_building = 0.1
        scaled_gold_to_building_owner = 0.05
    }

    unique_production_methods = {
        bank_maintenance = {
            paper = 0.1
            goods_gold = 0.1
            category = building_maintenance
        }
    }

    construction_demand = bank_construction
}

TRY_REPLACE:kokufu = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_nobles

    category = government_category

    max_levels = 1
    employment_size = large_noble_employment

    rural_settlement = yes
    town = yes
    city = yes

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
    }

    country_potential = {
        OR = {
            AND = {
                has_reform = government_reform:japanese_imperial_family
                country_type = building
            }
            has_reform = government_reform:japanese_clan
        }
    }

    build_time = soldier_building

    allow = {
        custom_tooltip = {
            text = kokufu_why_tt
            always = no
        }
    }

    modifier = {
        manpower_to_building_owner = 0.001
        can_recruit_regiment_in_this_location = yes
        gold_to_building_owner = 0.5
        merchant_power_from_building = 0.5
        merchant_capacity_from_building = 0.5
    }

    possible_production_methods = {
        estate_building_input
    }

    construction_demand = early_soldier_building_construction
}

TRY_REPLACE:gosho = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_nobles

    category = government_category

    max_levels = 1
    employment_size = large_noble_employment

    rural_settlement = yes
    town = yes
    city = yes

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
    }

    country_potential = {
        has_reform = government_reform:japanese_imperial_family
        country_type = building
    }

    build_time = soldier_building

    allow = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        any_foreign_building_countries_in_location = { this = scope:actor }
    }


    modifier = {
        manpower_to_building_owner = 0.001
        can_recruit_regiment_in_this_location = yes
        gold_to_building_owner = 0.1
    }

    possible_production_methods = {
        estate_building_input
    }

    construction_demand = early_soldier_building_construction
}

TRY_REPLACE:yamashiro = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_soldiers

    category = military_category

    max_levels = 1
    employment_size = manpower_employment

    rural_settlement = yes
    town = yes
    city = no

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
    }

    country_potential = {
        OR = {
            AND = {
                has_reform = government_reform:japanese_imperial_family
                country_type = building
            }
            has_reform = government_reform:japanese_clan
        }
    }

    build_time = soldier_building

    allow = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        trigger_if = {
            limit = {
                any_foreign_building_countries_in_location = { count > 0 }
            }
            OR = {
                any_foreign_building_countries_in_location = {
                    OR = {
                        this = scope:actor
                        has_mutual_scripted_relation = {
                            type = relation_type:alliance
                            target = scope:actor
                        }
                    }
                }
                custom_tooltip = {
                    text = we_are_shugo_tt
                    AND = {
                        NOR = {
                            this = location:izumi
                            this = location:iga
                            this = location:awa
                            this = location:oki
                            this = location:awaji
                        }
                        province_definition = {
                            any_location_in_province_definition = {
                                any_foreign_buildings_in_location = {
                                    owner ?= scope:actor
                                    building_type = building_type:kokufu
                                }
                            }
                        }
                    }
                }
            }
        }
    }


    modifier = {
        manpower_to_building_owner = 0.001
        can_recruit_regiment_in_this_location = yes
        gold_to_building_owner = 0.1
    }

    possible_production_methods = {
        estate_building_input
    }

    raw_modifier = {
    }

    construction_demand = early_soldier_building_construction
}

TRY_REPLACE:yakata = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_nobles

    category = government_category

    max_levels = 1
    employment_size = normal_noble_employment

    rural_settlement = yes
    town = yes
    city = yes

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
    }

    country_potential = {
        has_reform = government_reform:japanese_clan
    }

    build_time = soldier_building

    allow = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        any_foreign_building_countries_in_location = { this = scope:actor }
    }

    modifier = {
        gold_to_building_owner = 0.3
    }

    possible_production_methods = {
        estate_building_input
    }

    construction_demand = early_soldier_building_construction
}

TRY_REPLACE:shoen = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_peasants

    category = rgo_building_category

    max_levels = rural_building_cap
    employment_size = rural_peasant_produce_employment

    rural_settlement = yes
    town = yes
    city = no

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
    }

    country_potential = {
        OR = {
            AND = {
                has_reform = government_reform:japanese_imperial_family
                country_type = building
            }
            has_reform = government_reform:japanese_clan
        }
    }

    build_time = estate_build_time

    allow = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        OR = {
            any_foreign_building_countries_in_location = { this = scope:actor }
            custom_tooltip = {
                text = we_are_shugo_tt
                AND = {
                    NOR = {
                        this = location:izumi
                        this = location:iga
                        this = location:awa
                        this = location:oki
                        this = location:awaji
                    }
                    province_definition = {
                        any_location_in_province_definition = {
                            any_foreign_buildings_in_location = {
                                owner ?= scope:actor
                                building_type = building_type:kokufu
                            }
                        }
                    }
                }
            }
        }
    }

    modifier = {
        gold_to_building_owner = 0.5
        merchant_power_from_building = 0.5
        merchant_capacity_from_building = 0.5
        manpower_to_building_owner = 0.01
    }

    unique_production_methods = {
        shoen_quarries_maintenance = {
            produced = stone
            output = 0.5
            tools = 0.13
            category = building_maintenance
        }
        shoen_lumbermills_maintenance = {
            produced = lumber
            output = 0.6
            tools = 0.14
            fiber_crops = 0.15
            category = building_maintenance
        }
        shoen_fiber_crops_farm_maintenance = {
            produced = fiber_crops
            output = 0.5
            lumber = 0.25
            tools = 0.14
            category = building_maintenance
        }
        shoen_ironsand_maintenance = {
            produced = iron
            output = 0.3
            sand = 0.50
            tools = 0.15
            category = building_maintenance
        }
        shoen_masonry_maintenance = {
            produced = masonry
            output = 0.8
            lumber = 0.3
            tools = 0.07
            category = building_maintenance
        }
    }

    construction_demand = japanese_clan_building_construction
}

TRY_REPLACE:tatara = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_peasants

    category = basic_industry_category

    max_levels = rural_building_cap
    employment_size = estate_peasants_employment

    rural_settlement = yes
    town = yes
    city = yes

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
    }

    country_potential = {
        OR = {
            AND = {
                has_reform = government_reform:japanese_imperial_family
                country_type = building
            }
            has_reform = government_reform:japanese_clan
        }
    }

    build_time = estate_build_time

    allow = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        any_foreign_building_countries_in_location = { this = scope:actor }
    }

    unique_production_methods = {
        tamagahane_blacksmith = {
            produced = tools
            output = 0.5
            iron = 0.4
            category = guild_input
        }
        tamagahane_bladesmith = {
            produced = weaponry
            output = 0.2
            iron = 0.17
            category = guild_input
        }
    }

    construction_demand = japanese_clan_building_construction
}

TRY_REPLACE:clan_shipyards = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_peasants

    category = basic_industry_category

    max_levels = rural_building_cap
    employment_size = manpower_employment

    rural_settlement = yes
    town = yes
    city = no

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        is_coastal = yes
    }

    country_potential = {
        OR = {
            AND = {
                has_reform = government_reform:japanese_imperial_family
                country_type = building
            }
            has_reform = government_reform:japanese_clan
        }
    }

    build_time = estate_build_time

    allow = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        any_foreign_building_countries_in_location = { this = scope:actor }
    }

    possible_production_methods = {
        estate_building_input
    }

    modifier = {
        building_owner_maritime_presence = 0.5
        max_ships_built_at_same_time = 1
        sailors_to_building_owner = 0.01
        can_build_ships_in_this_location = yes
    }

    construction_demand = early_soldier_building_construction
}

TRY_REPLACE:clan_family_shrine = {
    is_foreign = yes
    stronger_power_projection = no
    need_good_relation = yes
    pop_type = foreign_clergy

    category = religious_category

    max_levels = 1
    employment_size = large_religious_building_employment

    rural_settlement = yes
    town = yes
    city = yes

    ai_foreign_ignore_naval_range = yes

    location_potential = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
    }

    country_potential = {
        OR = {
            AND = {
                has_reform = government_reform:japanese_imperial_family
                country_type = building
            }
            has_reform = government_reform:japanese_clan
        }
    }

    build_time = estate_build_time

    allow = {
        dominant_culture = { has_culture_group = culture_group:japanese_group }
        any_foreign_building_countries_in_location = { this = scope:actor }
    }

    possible_production_methods = {
        estate_building_input
    }

    modifier = {
        gold_to_building_owner = 0.05
        manpower_to_building_owner = 0.001
    }

    construction_demand = japanese_clan_building_construction
}

TRY_REPLACE:venetian_quarter = {
    is_foreign = yes
    pop_type = foreign_burghers

    need_good_relation = yes
    employment_size = large_foreign_trade_employment
    max_levels = italian_merchant_quarters_max_level
    category = trade_category
    town = yes
    city = yes
    country_potential = {
        tag = VEN
    }
    location_potential = { this = location:constantinople }
    allow = { within_naval_range_of = scope:actor }
    remove_if = {
        owner = {
            NOT = { tag = VEN }
        }
    }
    can_destroy = {
        scope:building.owner = scope:actor
    }
    expensive = yes
    build_time = trade_post_build_time
    modifier = {
        merchant_capacity_from_building = 1.0
        building_owner_maritime_presence = 0.025
    }
    possible_production_methods = {
        venetian_quarter_maintenance
    }
    construction_demand = market_center_building_construction
}

TRY_REPLACE:galata = {
    is_foreign = yes

    need_good_relation = yes
    pop_type = foreign_burghers
    employment_size = large_foreign_trade_employment
    max_levels = italian_merchant_quarters_max_level
    category = trade_category
    town = yes
    city = yes
    country_potential = {
        tag = GEN
    }
    location_potential = { this = location:constantinople }

    remove_if = {
        owner = {
            NOT = { tag = GEN }
        }
    }

    can_destroy = {
        scope:building.owner = scope:actor
    }

    allow = { within_naval_range_of = scope:actor }
    expensive = yes
    build_time = trade_post_build_time
    modifier = {
        merchant_capacity_from_building = 1.0
        building_owner_maritime_presence = 0.025
    }
    possible_production_methods = {
        galata_maintenance
    }
    construction_demand = market_center_building_construction
}

TRY_REPLACE:trans_saharan_trade_outposts = {
    is_foreign = yes
    need_good_relation = yes

    pop_type = foreign_burghers
    employment_size = trade_employment
    max_levels = 1
    category = trade_category
    town = yes
    city = yes
    country_potential = {
        custom_tooltip = {
            text = son_unlocked_trans_saharan_outposts_tt
            has_variable = son_trans_saharan_trade_building_variable
        }
    }
    allow = {
        OR = {
            this = location:cairo
            this = location:fez
            this = location:tunis
        }
    }
    expensive = yes
    build_time = trade_post_build_time
    modifier = {
        merchant_capacity_from_building = 1.0
        merchant_power_from_building = 2
    }

    unique_production_methods = {
        trans_saharan_trade_outposts_maintenance = {
            lumber = 0.5
            category = building_maintenance
        }
    }
    construction_demand = market_center_building_construction
}

TRY_REPLACE:por_feitoria = {
    in_empty = any
    is_foreign = yes
    stronger_power_projection = yes
    max_levels = 1
    pop_type = foreign_burghers
    category = trade_category

    employment_size = foreign_trade_employment

    location_potential = {
        is_port = yes
        custom_tooltip = {
            text = not_on_same_continent_as_capital
            continent != scope:actor.capital.continent
        }
    }

    rural_settlement = yes
    town = yes
    city = yes

    expensive = yes
    build_time = trade_post_build_time


    unique_production_methods = {
        feitoria_maintenance = {
            masonry = 0.5
            naval_supplies = 0.5
            category = building_maintenance
        }
    }

    construction_demand = por_feitoria_building_construction

    modifier = {
        building_owner_maritime_presence = 0.025
        merchant_capacity_from_building = 0.25
        merchant_power_from_building = 1
    }
}

TRY_REPLACE:gurgaddi = {

    max_levels = 1
    pop_type = foreign_clergy

    is_foreign = yes
    need_good_relation = yes

    category = religious_category
    conversion_religion = sikhism
    employment_size = religious_building_employment

    rural_settlement = yes
    town = yes
    city = yes

    country_potential = {
        tag = SIKH
    }

    build_time = religious_building_time



    possible_production_methods = {
        monastery_maintenance
    }

    construction_demand = town_building_construction


    modifier = {
        local_clergy_max_literacy = 10
    }
}